#!/usr/bin/env bash
# arguement 2 is stored in $package
package=$2

# dave t boulderson might be a person but probably isnt
bold=$(tput bold)
nomal=$(tput sgr0) # nomal!!!11!!!

# check if -nc has been specified, if so set $nc to true else false
for i in $@; do
  if [[ $i == "-nc" ]]; then
    nc="true"
  else
    nc="false"
  fi
done

# help func
help() {
  #echos for the help thing
  echo "usage: nonemus [commands] [...]"
  echo "commands: "
  echo "    nonemus install <package> <-nc>----- installs the specified package from the aur, -nc skips all confirmation, --skipsignatures skips signatures"
  echo "    nonemus test-stuff -------- is js for testing whatever without installing packages"
  echo "    nonemus -h ------ shows this"
  echo "thats all currently"
  exit 0
}
# nothing specified? display help message
if [[ -z $1 ]]; then
  help 0
elif [[ $1 == -h || $1 == "help" ]]; then
  help 0
elif [[ $1 == "test-stuff" ]]; then
  echo $(tput setab 6)$(tput setaf 1)dollar ${bold}$(tput setab 2)$(tput setaf 0)testing$nomal
elif [[ $1 == "install" ]]; then
  # did you specify a package?
  if [[ -z $2 ]]; then
    echo "you didnt specify a package. -h"
    exit 1
  else
    # you did specify a package
    echo "getting PKGBUILD for package $package..."
    # STEAL the pkgbuild from the aur
    git clone https://aur.archlinux.org/${package}
    # enter the folder
    cd "${package}"
    # if you specified -nc skip editing pkgbuild
    if [[ $nc == true ]]; then
      echo skipping PKGBUILD edit
    else
      # asking to edit pkgbuild, default is no because my preference, and yes i know it can be a security risk.
      read -p "${bold}wanna edit PKGBUILD? (y/N) ${nomal}" editpkg
    fi
    if [[ $editpkg == "y" || $editpkg == "yes" ]]; then
      # if you chose to edit the pkgbuild edit it
      echo will use whats in \$EDITOR, aka $EDITOR
      $EDITOR PKGBUILD
    else
      echo skipping editing PKGBUILD either cuz no or -nc
    fi
    if [[ $nc == true ]]; then
      #install if -nc specified
      echo ${bold}already installing cuz -nc${nomal}
      makepkg -si
      installornot=false
    else
      #ask for confirmation
      read -r -p "${bold}$(tput setaf 1)DO YOU WANT TO INSTALL $package. WE NEED CONFIRMATION!!${nomal}${bold} (Y/n) ${nomal}" installornot
    fi
    if [[ $installornot == "n" || $installornot == "no" ]]; then
      # you chose to not install
      cd ..
      rm -rf $package
      echo ${bold}$(tput setaf 1)not installed.$nomal
    elif [[ $nc == true ]]; then
      # you specified -nc and now its telling you its probably installed, removing the original folder in the process!!!
      echo ${bold}$(tput setaf 2)probably installed now!!
      cd ..
      rm -rf $package
    else
      # install it
      echo ${bold}$(tput setaf 4)installing!!!${nomal}
      for i in "$@"; do
        if [[ $i == "--skipsignatures" ]]; then
          makepkg -si --skippgpcheck
          pgpskip=true
        fi
      done
      if [[ pgpskip != true ]]; then
        makepkg -si
      fi
      cd ..
      rm -rf $package
    fi
  fi
else
  #you didnt specify a supported command so heres the error message
  echo "$1 is not a currently supported command, use -h."
  exit 2
fi
